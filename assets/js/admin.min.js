(function(b,e){var f={addTour:function(){e.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGetTourHtml"},dataType:"json",beforeSend:function(){f.Waiting.waiting()}}).done(function(h,i,g){if(h.status){f.Modal.showModal('<i class="fas fa-plus"></i> New tour',h.data.html);f.Waiting.success()}else{f.Log.appendArray(h.messages);f.Waiting.stay()}}).fail(function(g,i,h){alert("Ajax failed");f.Waiting.stay()}).always(function(){f.Waiting.stay()})},editTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetTourHtml"},dataType:"json",beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status){f.Modal.showModal('<i class="fas fa-edit"></i> Edit tour',j.data.html);f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(i,k,j){alert("Ajax failed");f.Waiting.stay()}).always(function(i,j,i){f.Waiting.stay()})},editTourHotspot:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetHotspotEditorHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status){f.Modal.showModal('<i class="fas fa-edit"></i> Hotspots management',j.data.html);f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},editProfile:function(g){e.ajax({url:"index.php",type:"POST",data:{view:"user",task:"ajaxGetUserHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(i,j,h){if(i.status){f.Modal.showModal('<i class="fa fa-user-circle" aria-hidden="true"></i> Edit profile',i.data.html);f.Waiting.success()}else{f.Log.appendArray(i.messages);f.Waiting.stay()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},embedTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetTourEmbedHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status){f.Modal.showModalWithText('<i class="fa fa-code" aria-hidden="true"></i> Embed code',j.data.html);f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(i,k,j){alert("Ajax failed");f.Waiting.stay()}).always(function(){f.Waiting.stay()})},deleteTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxDeleteTour"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status==true){e("table#vTours tr#vtour-"+h).remove();f.Waiting.success()}}).fail(function(i,k,j){alert("Ajax failed");f.Waiting.stay()}).always(function(){f.Waiting.stay()})},hooks:function(){e("body").on("click","#search-reset",function(g){g.preventDefault();e('input[name="keyword"]').val("");e('form[name="search-form"]').submit()});e("body").on("click","#tour-add",function(){f.addTour()});e("body").on("click",".tour-edit",function(){f.editTour(this)});e("body").on("click",".tour-edit-hotspots",function(){f.editTourHotspot(this)});e("body").on("click","a.user-avatar",function(){f.editProfile(this)});e("body").on("submit","form#user-form",function(g){g.preventDefault();var h=new FormData(this);e.ajax({url:"index.php",type:"POST",data:h,async:true,cache:false,processData:false,contentType:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){f.Log.appendArray(j.messages);f.Waiting.stay()}).fail(function(i,k,j){alert("Ajax failed");f.Waiting.stay()}).always(function(){f.Waiting.stay()})});e("body").on("click",".tour-embed",function(){f.embedTour(this)});e("body").on("click",".tour-delete",function(g){g.preventDefault();if(confirm("Confirm delete a tour")){f.deleteTour(this)}});e("body").on("click","button.btn-log-close",function(g){g.preventDefault();f.Log.reset();e("body").removeClass("loading")});e("body").on("change","input.check-all",function(g){isChecked=e("input.check-all").attr("checked")?true:false;if(isChecked){jQuery("input.check-tour").prop("checked",true)}else{jQuery("input.check-tour").prop("checked",false)}});c.hooks()}};var c={generateAlias:function(){var g=e("#tour-form input#name").val();g=g.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");e("#tour-form input#alias").val(g)},validateAlias:function(h,g){e.ajax({url:"index.php",type:"POST",data:{id:h,alias:g,view:"tour",task:"ajaxValidateAlias"},dataType:"json",beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status==true){f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(i,k,j){alert("Ajax failed");f.Waiting.stay()}).always(function(i,j,i){f.Waiting.stay()})},hooks:function(){e("body").on("blur","#tour-form input#name",function(){c.generateAlias()});e("body").on("blur","#tour-form input#alias",function(){var h=e('#tour-form input[name="id"]');var g=e("#tour-form input#alias").val();if(h.length==1){h=e(h).val()}else{h=0}c.validateAlias(h,g)});e("body").on("submit","form#tour-form",function(g){g.preventDefault();var h=new FormData(this);e.ajax({url:"index.php",type:"POST",data:h,async:true,cache:false,processData:false,contentType:false,dataType:"json",beforeSend:function(){e("body").addClass("loading");e("#overlay-waiting .btn-log-close").addClass("hide")}}).done(function(j,k,i){f.Log.appendArray(j.messages);f.Waiting.stay()}).fail(function(i,k,j){alert("Ajax failed");f.Waiting.stay()}).always(function(i,j,i){f.Waiting.stay()})});d.hooks();a.hooks()}};var d={addNew:function(){var g=e(".hidden .scene").parent().html();e("#scenes .alert").remove();e("#scenes").append(g);e.validate({modules:"file"})},makeDefault:function(g){e("#tour-form input[type='checkbox'][name='sceneDefault']:checked").prop("checked",false);e(g).prop("checked",true)},remove:function(g){e(g).parent().parent().parent().parent().remove()},hooks:function(){e("body").on("click","button#tour-scene-add",function(){d.addNew()});e("body").on("click","#tour-form button.tour-scene-remove",function(h){var g=h.target||h.currentTarget;d.remove(g)});e("body").on("change","#tour-form input[type='checkbox'][name='sceneDefault']",function(h){var g=h.target||h.currentTarget;d.makeDefault(g)})}};var a={saveHotspot:function(g){var i=e(g).data("tour-id");var h=document.getElementById("editTourHotspots").contentWindow;if(!h.isReady()){alert("Please finish to add hotspot before saving or click cancel");return false}e.ajax({url:"index.php",type:"POST",data:{view:"hotspot",task:"ajaxSaveHotspot",id:i,hotspotList:JSON.stringify(h.superHotspot.getData().hotspotList),defaultViewList:JSON.stringify(h.defaultViewList)},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(k,l,j){f.Log.appendArray(k.messages);f.Waiting.stay()}).fail(function(j,l,k){alert("Ajax failed");f.Waiting.stay()}).always(function(j,k,j){f.Waiting.stay()})},hooks:function(){e("body").on("click","button#hotspots-save",function(g){g.preventDefault();f.Tour.Hotspot.saveHotspot(this)})}};f.Tour=c;f.Tour.Scene=d;f.Tour.Hotspot=a;b.vrAdmin=f;e(document).ready(function(){b.vrAdmin.hooks()})})(window,jQuery);